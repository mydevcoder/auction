<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Teams</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
      body {
        background: #f8f9fa;
      }
      .team-select {
        max-width: 300px;
        margin: auto;
      }
      table {
        margin-top: 20px;
        font-size: 0.9rem;
      }
      .table-container {
        max-width: 800px;
        margin: auto;
      } /* keeps tables narrower */
      .btn-bck{
        margin: 10px;
      }
    </style>
  </head>
  <body>
    <div class="container mt-4 mb-4">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h1>Teams & Players</h1>
        <a href="app.html" class="btn btn-light back-btn btn-bck"><i class="fa-solid fa-left-long"></i></a>
      </div>

      <!-- Dropdown to select team -->
      <div class="team-select mb-5">
        <select id="teamSelect" class="form-select ">
          <option value="">-- Select a Team --</option>
          <option value="IMJ NINJAS">IMJ NINJAS</option>
          <option value="IMJ IGNITORS">IMJ IGNITORS</option>
          <option value="IMJ TITANS">IMJ TITANS</option>
          <option value="IMJ FALCONS">IMJ FALCONS</option>
          <option value="IMJ PHANTOMS">IMJ PHANTOMS</option>
          <option value="IMJ HAWKS">IMJ HAWKS</option>
        </select>
      </div>

      <!-- Table container -->
      <div id="teamTableContainer" class="mt-4 mb-4" ></div>
    </div>

    <script>
      const API_URL = "http://localhost:5000";
      let allTeams = [];

      async function loadTeams() {
        const res = await fetch(`${API_URL}/teams`);
        allTeams = await res.json();
      }

      function renderTeam(teamName) {
        const container = document.getElementById("teamTableContainer");
        container.innerHTML = "";

        if (!teamName) {
          container.innerHTML =
            '<div class="alert alert-info text-center">Please select a team to view players.</div>';
          return;
        }

        const team = allTeams.find((t) => t.name === teamName);
        if (!team) {
          container.innerHTML =
            '<div class="alert alert-warning text-center">No such team found.</div>';
          return;
        }

        let html = `
          <div class="table-container">
            <h4 class="text-center mt-3">${team.name}</h4>
            <table class="table table-sm table-striped table-bordered table-hover">
              <thead class="table-dark">
                <tr>
                  <th>Player Name</th>
                  <th>Class</th>
                  <th>Sold Price</th>
                </tr>
              </thead>
              <tbody>
        `;

        if (team.players.length > 0) {
          team.players.forEach((p) => {
            html += `
              <tr>
                <td>${p.name}</td>
                <td>${p.className}</td>
                <td>${p.soldPrice}</td>
              </tr>
            `;
          });
        } else {
          html += `<tr><td colspan="3" class="text-center">No players won yet.</td></tr>`;
        }

        html += "</tbody></table></div>";
        container.innerHTML = html;
      }

      // Event listener for dropdown
      document.addEventListener("DOMContentLoaded", async () => {
        await loadTeams();

        document
          .getElementById("teamSelect")
          .addEventListener("change", (e) => {
            renderTeam(e.target.value);
          });
      });
    </script>
  </body>
</html>
